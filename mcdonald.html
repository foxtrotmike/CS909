<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Area vs Constraint Residual (L=1) — (r,A) view</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 16px; }
    h1 { font-size: 18px; margin: 0 0 12px; }

    .grid { display: grid; grid-template-columns: 380px 1fr; gap: 16px; align-items: start; }
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr; } }

    .card {
      border: 1px solid rgba(127,127,127,0.35);
      border-radius: 14px;
      padding: 12px 12px 10px;
      box-shadow: 0 1px 8px rgba(0,0,0,0.06);
      background: rgba(127,127,127,0.06);
    }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: space-between; }
    label { font-size: 13px; opacity: 0.9; }
    input[type="range"] { width: 100%; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
    .big { font-size: 16px; }
    .muted { opacity: 0.8; }

    .kpi { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    .kpi .box { border: 1px solid rgba(127,127,127,0.35); border-radius: 12px; padding: 10px; background: rgba(255,255,255,0.05); }
    .kpi .box .t { font-size: 12px; opacity: 0.85; margin-bottom: 4px; }
    .kpi .box .v { font-size: 16px; font-weight: 600; }

    .btnrow { display:flex; gap:10px; flex-wrap: wrap; margin-top: 10px; }
    button {
      border-radius: 12px; border: 1px solid rgba(127,127,127,0.35);
      padding: 8px 10px; cursor: pointer; background: rgba(127,127,127,0.10);
    }
    button:hover { background: rgba(127,127,127,0.16); }

    .vizGrid { display:grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    @media (max-width: 1100px) { .vizGrid { grid-template-columns: 1fr; } }

    canvas {
      width: 100%;
      height: auto;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,0.35);
      background: rgba(255,255,255,0.05);
    }
    .legend { font-size: 12px; opacity: 0.85; margin-top: 8px; line-height: 1.35; }
    .pill { display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid rgba(127,127,127,0.35); background: rgba(127,127,127,0.08); margin-right: 6px; }
    .note { font-size: 12px; opacity: 0.85; margin-top: 10px; line-height: 1.35; }

    #raPlotDiv {
      width: 100%;
      height: 380px;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,0.35);
      background: rgba(255,255,255,0.05);
      overflow: hidden;
    }
  </style>

  <!-- Plotly (CDN, needs internet) -->
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
</head>

<body>
  <h1>Rectangle with free (l,w): show area A and constraint residual r, and a clean (r,A) plot</h1>

  <div class="grid">
    <div class="card">
      <div class="row">
        <div>
          <div class="muted" style="font-size:12px;">Constraint</div>
          <div class="mono big">2(l + w) = L = 1</div>
          <div class="mono muted">Residual r(l,w) = 2(l+w) − 1</div>
        </div>
        <div class="pill mono">A = l · w</div>
      </div>

      <div style="margin-top:12px;">
        <label for="lRange">Choose l (free):</label>
        <input id="lRange" type="range" min="0" max="0.5" step="0.0005" value="0.25" />
      </div>

      <div style="margin-top:10px;">
        <label for="wRange">Choose w (free):</label>
        <input id="wRange" type="range" min="0" max="0.5" step="0.0005" value="0.25" />
      </div>

      <div class="kpi">
        <div class="box">
          <div class="t">l</div>
          <div class="v mono" id="lVal">0.2500</div>
        </div>
        <div class="box">
          <div class="t">w</div>
          <div class="v mono" id="wVal">0.2500</div>
        </div>
        <div class="box">
          <div class="t">Area A = l·w</div>
          <div class="v mono" id="aVal">0.062500</div>
        </div>
        <div class="box">
          <div class="t">Residual r = 2(l+w) − 1</div>
          <div class="v mono" id="rVal">0.0000</div>
        </div>
        <div class="box">
          <div class="t">Perimeter P = 2(l+w)</div>
          <div class="v mono" id="pVal">1.0000</div>
        </div>
        <div class="box">
          <div class="t">Feasible optimum (on r=0)</div>
          <div class="v mono" id="optVal">A*=0.062500 at l=w=0.25</div>
        </div>
      </div>

      <div class="btnrow">
        <button id="toFeasibleOptBtn" type="button">Jump to feasible optimum (square)</button>
        <button id="randomBtn" type="button">Random (l,w)</button>
        <button id="projectBtn" type="button">Project to r=0 (keep l, set w)</button>
      </div>

      <div class="note">
        Right-hand plot is in <span class="mono">(r,A)</span> coordinates.
        The dot is your current operating point <span class="mono">(r(l,w), A(l,w))</span>.
        The dashed line is feasibility: <span class="mono">r=0</span>.
      </div>
    </div>

    <div class="card">
      <div class="row" style="margin-bottom: 8px;">
        <div class="muted" style="font-size:12px;">
          Left: rectangle. Right: (residual r, area A) with current point.
        </div>
        <div class="mono muted">(c) Fayyaz Minhas</div>
      </div>

      <div class="vizGrid">
        <div>
          <div class="muted" style="font-size:12px; margin: 0 0 6px;">Rectangle view (aspect ratio l:w)</div>
          <canvas id="rectCanvas" width="520" height="380"></canvas>
          <div class="legend">
            <span class="pill mono">Text</span> includes <span class="mono">A</span> and <span class="mono">r</span>.
            <span class="pill mono">Feasible</span> means <span class="mono">r=0</span>.
          </div>
        </div>

        <div>
          <div class="muted" style="font-size:12px; margin: 0 0 6px;">Clean plot in (r,A): constraint violation vs area</div>
          <div id="raPlotDiv"></div>
          <div class="legend">
            x-axis: <span class="mono">r = 2(l+w) − 1</span> (constraint violation). y-axis: <span class="mono">A = l·w</span>.
          </div>
        </div>
      </div>

      <div class="note">
        On <span class="mono">r=0</span>, the best achievable area is <span class="mono">A=0.0625</span> at <span class="mono">l=w=0.25</span>.
        If you allow <span class="mono">r&gt;0</span>, you can get larger areas, but you are exceeding <span class="mono">L</span>.
      </div>
    </div>
  </div>

  <script>
    const L = 1.0;

    const lRange = document.getElementById('lRange');
    const wRange = document.getElementById('wRange');

    const lVal = document.getElementById('lVal');
    const wVal = document.getElementById('wVal');
    const aVal = document.getElementById('aVal');
    const rVal = document.getElementById('rVal');
    const pVal = document.getElementById('pVal');
    const optVal = document.getElementById('optVal');

    const rectCanvas = document.getElementById('rectCanvas');
    const rectCtx = rectCanvas.getContext('2d');

    const toFeasibleOptBtn = document.getElementById('toFeasibleOptBtn');
    const randomBtn = document.getElementById('randomBtn');
    const projectBtn = document.getElementById('projectBtn');

    const lStar = 0.25;
    const wStar = 0.25;
    const AStar = lStar * wStar;
    optVal.textContent = `A*=${AStar.toFixed(6)} at l=w=0.25`;

    function clamp(x, lo, hi) { return Math.max(lo, Math.min(hi, x)); }

    function compute(l, w) {
      const A = l * w;
      const P = 2 * (l + w);
      const r = P - L; // = 2(l+w)-1
      return { l, w, A, P, r };
    }

    function clear(ctx, W, H) { ctx.clearRect(0, 0, W, H); }

    function drawRect(state) {
      const W = rectCanvas.width, H = rectCanvas.height;
      clear(rectCtx, W, H);

      rectCtx.save();
      rectCtx.globalAlpha = 0.16;
      const grid = 20;
      rectCtx.beginPath();
      for (let x = 0; x <= W; x += grid) { rectCtx.moveTo(x, 0); rectCtx.lineTo(x, H); }
      for (let y = 0; y <= H; y += grid) { rectCtx.moveTo(0, y); rectCtx.lineTo(W, y); }
      rectCtx.stroke();
      rectCtx.restore();

      const pad = 44;
      const maxDrawW = W - 2 * pad;
      const maxDrawH = H - 2 * pad;

      const l = Math.max(state.l, 1e-9);
      const w = Math.max(state.w, 1e-9);

      const scale = Math.min(maxDrawW / l, maxDrawH / w);
      const drawW = l * scale;
      const drawH = w * scale;

      const x0 = (W - drawW) / 2;
      const y0 = (H - drawH) / 2;

      rectCtx.save();
      rectCtx.lineWidth = 2;
      rectCtx.strokeRect(x0, y0, drawW, drawH);
      rectCtx.restore();

      rectCtx.save();
      rectCtx.font = '13px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';
      rectCtx.globalAlpha = 0.95;
      rectCtx.fillText(`l = ${state.l.toFixed(4)}`, x0, y0 - 10);
      rectCtx.fillText(`w = ${state.w.toFixed(4)}`, x0, y0 + drawH + 18);
      rectCtx.fillText(`A = l·w = ${state.A.toFixed(6)}`, x0, y0 + drawH + 38);
      rectCtx.fillText(`P = 2(l+w) = ${state.P.toFixed(6)}`, x0, y0 + drawH + 58);
      rectCtx.fillText(`r = P − L = ${state.r.toFixed(6)}`, x0, y0 + drawH + 78);
      rectCtx.restore();
    }

    // Simple (r,A) plot: no density, no heatmap.
    const RAPlot = { initialised: false };

    function drawRAPlot(state) {
      const currentPoint = {
        type: 'scatter',
        mode: 'markers+text',
        x: [state.r],
        y: [state.A],
        text: ['current'],
        textposition: 'top center',
        marker: { size: 10 },
        hovertemplate: 'current<br>r=%{x:.6f}<br>A=%{y:.6f}<extra></extra>'
      };

      const r0Line = {
        type: 'scatter',
        mode: 'lines',
        x: [0, 0],
        y: [0, 0.25],
        line: { width: 2, dash: 'dash' },
        hoverinfo: 'skip',
        name: 'r=0'
      };

      const feasibleOpt = {
        type: 'scatter',
        mode: 'markers+text',
        x: [0],
        y: [AStar],
        text: ['feasible max'],
        textposition: 'bottom center',
        marker: { size: 9 },
        hovertemplate: 'feasible max<br>r=0<br>A=%{y:.6f}<extra></extra>'
      };

      const layout = {
        margin: { l: 55, r: 10, t: 10, b: 45 },
        xaxis: { title: 'residual r = 2(l+w) − 1', range: [-1, 1], zeroline: false },
        yaxis: { title: 'area A = l·w', range: [0, 0.25] }
      };

      const config = { displayModeBar: false, responsive: true };

      if (!RAPlot.initialised) {
        Plotly.newPlot('raPlotDiv', [r0Line, feasibleOpt, currentPoint], layout, config);
        RAPlot.initialised = true;
      } else {
        // Update only the current point (trace index 2)
        Plotly.restyle('raPlotDiv', { x: [[state.r]], y: [[state.A]] }, [2]);
      }
    }

    function update() {
      const l = parseFloat(lRange.value);
      const w = parseFloat(wRange.value);
      const state = compute(l, w);

      lVal.textContent = state.l.toFixed(4);
      wVal.textContent = state.w.toFixed(4);
      aVal.textContent = state.A.toFixed(6);
      rVal.textContent = state.r.toFixed(6);
      pVal.textContent = state.P.toFixed(6);

      drawRect(state);
      drawRAPlot(state);
    }

    toFeasibleOptBtn.addEventListener('click', () => {
      lRange.value = String(lStar);
      wRange.value = String(wStar);
      update();
    });

    randomBtn.addEventListener('click', () => {
      const l = Math.random() * 0.5;
      const w = Math.random() * 0.5;
      lRange.value = String(l);
      wRange.value = String(w);
      update();
    });

    projectBtn.addEventListener('click', () => {
      // Keep l, set w so that r=0, i.e. l+w=0.5
      const l = parseFloat(lRange.value);
      const w = clamp(0.5 - l, 0, 0.5);
      wRange.value = String(w);
      update();
    });

    lRange.addEventListener('input', update);
    wRange.addEventListener('input', update);

    update();
  </script>
</body>
</html>
